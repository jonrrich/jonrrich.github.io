window.GameController=["$scope","$timeout","PeerService","KeyboardService","LoadService",function(a,g,x,y,z){function h(a){for(;0>a;)a+=2*Math.PI;for(;a>=2*Math.PI;)a-=2*Math.PI;return a}function A(e){var b=[{x:Math.floor(-c.width/2),y:Math.floor(-c.height/2)},{x:Math.floor(-c.width/2),y:Math.ceil(c.height/2)},{x:Math.ceil(c.width/2),y:Math.floor(-c.height/2)},{x:Math.ceil(c.width/2),y:Math.ceil(c.height/2)}];b.forEach(function(b){return b.theta=a.jetTheta});var u={x:e.x+c.width/2,y:e.y+c.height/
2},k=null,f=null;b.map(function(a){return v(a,u)}).forEach(function(a){if(null==k||a.x<k)k=a.x;if(null==f||a.y<f)f=a.y});e=w(m,k,f);for(b=0;b<n.length;b++)for(var d=0;d<n[0].length;d++)if(n[b][d]){var l=v({x:d-c.width/2,y:b-c.height/2,theta:a.jetTheta},u),g=l.y-f,h=l.x-k;if(0>l.x||0>l.y||l.y>m.height||e[g]&&e[g][h])return!0}return!1}function w(a,b,c){q.clearRect(0,0,d.width,d.height);q.drawImage(a,b,c,a.width,a.height,0,0,a.width,a.height);b=q.getImageData(0,0,Math.min(a.width,d.width),Math.min(a.height,
d.height));a=b.width;b=b.data;c=Array(a).fill(1).map(function(a){return[]});for(var e=0;e<b.length;e+=4){var f=e/4;c[Math.floor(f/a)][f%a]=255>b[e+3]?0:1}return c}function v(a,b){b=b||{x:0,y:0};var c=a.x,e=a.y,d=a.theta;return{x:Math.round(b.x+c*Math.cos(d)-e*Math.sin(d)),y:Math.round(b.y+c*Math.sin(d)+e*Math.cos(d))}}var c=document.getElementById("jet"),m=document.getElementById("map");a.jetX=50;a.jetY=200;a.jetTheta=0;a.levelProgress=0;a.paused=!1;a.crashed=!1;a.completed=!1;a.loaded=!1;var d=document.createElement("canvas"),
q=d.getContext("2d"),n,r=a.getLevelInfo(a.currentScreen);if(r.unlocked()){z([{element:c,src:"resources/jet_"+a.currentJet+".png"},{element:m,src:"resources/map_"+a.getLevelInfo(a.currentScreen).levelString()+".png"}],function(){a.mapWidth=m.width;a.loaded=!0;n=w(c,0,0);d.width=Math.ceil(Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2)))+1;d.height=d.width});"tilt"==a.currentControls&&x.config({onReceive:function(c){"tilt"!=a.currentControls||!c.theta||a.paused||a.crashed||a.completed||g(function(){var b=
h(-c.theta),e=h(-a.jetTheta),d=h(b-e);b=h(e-b);a.jetTheta=d<b?a.jetTheta-d:a.jetTheta+b},0)}});var p=y(),t=function(){"keys"!=a.currentControls||a.paused||a.crashed||a.completed||(p("ArrowUp")&&!p("ArrowDown")&&g(function(){a.jetTheta-=.025},0),p("ArrowDown")&&!p("ArrowUp")&&g(function(){a.jetTheta+=.025},0));if(a.loaded&&!a.paused&&!a.crashed&&!a.completed){var c=2*Math.cos(a.jetTheta),b=2*Math.sin(a.jetTheta);a.jetX+=isNaN(c)?0:c;a.jetY+=isNaN(b)?0:b;a.levelProgress=Math.max(0,Math.min(100,Math.floor(a.jetX/
a.mapWidth*100)));A({x:a.jetX,y:a.jetY})?(a.crashed=!0,a.markLevelProgress(r,a.levelProgress)):a.jetX>=a.mapWidth&&(a.completed=!0,a.markLevelProgress(r,100))}g(t,10)};t();a.$on("$destroy",function(){t=function(){}});a.pause=function(c,b){b&&(b.preventDefault(),b.stopPropagation());a.paused=c}}else a.switchScreen("Title 3")}];